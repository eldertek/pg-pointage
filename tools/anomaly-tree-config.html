<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arbre de configuration des scénarios d'anomalies</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f9fb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1100px;
      margin: 32px auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      padding: 32px;
    }
    h1 {
      color: #00346E;
      margin-bottom: 24px;
    }
    .actions {
      margin-bottom: 24px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    button {
      background: #00346E;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }
    button:hover {
      background: #0051a8;
    }
    button.config {
      background: #2E7D32;
    }
    button.config:hover {
      background: #1B5E20;
    }
    .tree {
      margin-top: 16px;
      font-size: 1rem;
    }
    .tree-node {
      margin-left: 24px;
      margin-bottom: 8px;
      border-left: 2px solid #e0e6ed;
      padding-left: 16px;
      position: relative;
    }
    .tree-node:before {
      content: '';
      position: absolute;
      left: -2px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #e0e6ed;
    }
    .tree-label {
      font-weight: bold;
      color: #00346E;
    }
    .tree-description {
      font-size: 0.85em;
      color: #666;
      margin: 4px 0 8px 24px;
      font-style: italic;
    }
    .tree-branch {
      margin-bottom: 12px;
      padding: 8px;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .tree-branch:hover {
      background: rgba(0, 0, 0, 0.03);
    }
    .branch-value {
      font-weight: 500;
    }
    .tree-action {
      color: #F78C48;
      font-weight: bold;
      margin-left: 8px;
    }
    .action-description {
      font-size: 0.85em;
      color: #666;
      margin: 4px 0 4px 24px;
      font-style: italic;
    }
    .tree-controls {
      display: flex;
      gap: 4px;
      margin-top: 8px;
    }
    .tree-controls button {
      background: #FB8C00;
      color: #fff;
      padding: 2px 8px;
      font-size: 0.85em;
    }
    .tree-controls button.delete {
      background: #F44336;
    }
    .tree-controls button:hover {
      opacity: 0.8;
    }
    select, input[type="text"], input[type="number"] {
      font-size: 1em;
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 100%;
      box-sizing: border-box;
    }
    .info-box {
      background: #E3F2FD;
      border-left: 4px solid #2196F3;
      padding: 12px 16px;
      margin-bottom: 24px;
      border-radius: 0 4px 4px 0;
    }
    .info-box h3 {
      margin-top: 0;
      color: #0D47A1;
    }
    .info-box p {
      margin-bottom: 0;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Arbre de configuration des scénarios d'anomalies</h1>

    <div class="info-box">
      <h3>Outil de configuration des règles de détection d'anomalies</h3>
      <p>Cet outil vous permet de configurer les règles de détection d'anomalies sous forme d'arbre de décision. Vous pouvez créer, modifier, importer et exporter des configurations complètes.</p>
      <p>Commencez par créer un nouvel arbre ou importez une configuration existante. Vous pouvez également configurer les marges et tolérances globales.</p>
    </div>

    <div class="actions">
      <button onclick="addRootCondition()" title="Créer un nouvel arbre de décision">Nouvel arbre</button>
      <button onclick="importTree()" title="Importer une configuration existante">Importer</button>
      <button onclick="exportTree()" title="Exporter la configuration actuelle">Exporter</button>
      <button class="config" onclick="configureSettings()" title="Configurer les marges et tolérances">Configurer marges</button>
      <input type="file" id="importFile" accept="application/json" style="display:none" onchange="handleImport(event)">
    </div>

    <div class="tree" id="treeContainer">
      <!-- L'arbre sera affiché ici -->
    </div>
  </div>
  <!-- Modale d'édition -->
  <div id="modalOverlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:1000;"></div>
  <div id="editModal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:32px 24px 24px 24px;border-radius:10px;box-shadow:0 4px 24px rgba(0,0,0,0.18);z-index:1001;min-width:320px;max-width:90vw;">
    <h2 id="modalTitle" style="color:#00346E;font-size:1.2em;margin-top:0;margin-bottom:16px;">Éditer</h2>
    <form id="modalForm">
      <div id="modalFields"></div>
      <div style="margin-top:24px;text-align:right;">
        <button type="button" onclick="closeModal()" style="background:#999;margin-right:8px;">Annuler</button>
        <button type="submit" style="background:#00346E;">Valider</button>
      </div>
    </form>
  </div>
  <script src="anomaly-tree-config.js"></script>
</body>
</html>